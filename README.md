# ewaff

Efficient and flexible algorithms for EWAS


## Things to do

- SmartSVA is apparently faster and 'better' than sva 
- dSVA is also supposed to be 'better'
- multi-core optional for windows or other debilitated users
- use tableone for output (per model)
- EWAS comparison function
- EWAS meta-analysis
- ~~EWAS report~~ expand report for multi-variable ewas
- support adjustment for case-control
- flexible batch control
- outlier removal
- ~~support robust regression~~
- bristol=T/F
 - comments in Bristolian, thanks love, that were gert lush.
 - downloading your data ... Bristol thanks you.
- correlation threshold for association between variable of interest and SVAs
- ~~use limma where possible to be faster~~
- recode sva so its faster

Things Gemma is suggesting here because she doesn't totally know
what she's doing with this gitlab malarky:

- ~~Needs to deal with NAs in phenotype data e.g. by matching
    na.omit(data) to methylation as part of the function. If we ask
    cohorts to do this step themselves before running the EWAS,
    they'll have to do it separately for each model if different
    models have covariates with different missing values... not
    explaining this brilliantly, but hopefully makes sense?!~~
- ~~can we set ret$table to be a dataframe instead of a matrix? (not
    sure why I suggested this, so let's ignore it)~~
- ~~I don't think the table in the output has rownames with cpg IDs
   currently?~~
- There's a case for having an sva model and an EWAS model: 1) sva
    doesn't cope with NAs so individuals with just one missing probe
    will be excluded from the full EWAS, 2) if you want to run two
    models, eg one adjusted for cells, one not, then the SVs for the
    unadjusted model will capture cell counts because they're not
    included in the SVA model. **Suggest a function called ewaff.pace() that runs the PACE workflow**
- Can we have "table one" as an object in the output? and/or can this
    be easily written to a standard dataframe/csv file?


## Proposal

Modify the formula to say whether and how many surrogate variables to include as follows:

- *methylation ~ x + y* No surrogate variables
- *methylation ~ x + y + sv* Include all surrogate variables generated by SVA
- *methylation ~ x + y + sv10* Include 10 surrogate variables 

